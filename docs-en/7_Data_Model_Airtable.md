# 7. Data Model - Airtable

Airtable serves as the central database for the system, where all important information about event settings and participant status is stored. This documentation describes the schema for the most important tables.

---

## 1. Table: `settings`

*   **Purpose:** Stores the overall configuration for the **current active event**. This row is updated by the **FGT Dashboard** when a Tournament Organizer configures an event.
*   **Key Fields:**

| Field Name                | Type               | Description                                                              | Example                           |
| :------------------------ | :----------------- | :----------------------------------------------------------------------- | :-------------------------------- |
| `Name`                    | `Single line text` | The name of the settings row (often just "Active Settings").             | `Active Settings`                 |
| `is_active`               | `Checkbox`         | **MUST BE CHECKED** for the system to recognize the row as the active configuration. | `[x]` (checked)                   |
| `active_event_slug`       | `Single line text` | The unique "slug" from Start.gg for the active tournament.               | `fgc-trollhattan-weekly-42`       |
| `event_date`              | `Date`             | The start date of the tournament (fetched from Start.gg).                | `2025-12-17`                      |
| `default_game`            | `Multi-select`     | A list of games selected by the TO to be visible in the form. Populated from Start.gg events. | `["Street Fighter 6", "Tekken 8"]` |
| `events_json`             | `Long text`        | Raw `JSON` data containing all information about the events from Start.gg. Used to build the `default_game` list. | `{"events": [...]}`               |
| `startgg_event_url`       | `URL`              | The original URL to the Start.gg tournament.                             | `https://start.gg/tournament/...` |
| `tournament_name`         | `Single line text` | The name of the tournament (from Start.gg).                              | `FGC Trollh√§ttan Weekly #42`      |
| `timezone`                | `Single line text` | The timezone of the tournament (from Start.gg).                          | `Europe/Stockholm`                |
| `swish_number`            | `Single line text` | Swish number for payments (if used).                                     | `1234567890`                      |
| `swish_expected_per_game` | `Number`           | Expected Swish payment per game (in SEK).                                | `50`                              |

---

## 2. Table: `active_event_data`

*   **Purpose:** Stores **live data** for each participant's check-in for the active event. This table is primarily updated by **N8N** and read by both the **Backend** and the **FGT Dashboard**.
*   **Key Fields:**

| Field Name                      | Type               | Description                                                              | Example                                    |
| :---------------------------- | :----------------- | :----------------------------------------------------------------------- | :----------------------------------------- |
| `name`                        | `Single line text` | The participant's full name (sanitized).                                 | `Anna Andersson`                           |
| `tag`                         | `Single line text` | The participant's gamer tag (sanitized). Used for matching against Start.gg. | `CoolPlayer`                               |
| `email`                       | `Email`            | The participant's email address.                                         | `anna@example.com`                         |
| `telephone`                   | `Phone number`     | The participant's phone number (sanitized, digits only).                 | `0701234567`                               |
| `personnummer`                | `Single line text` | The participant's personal ID number (sanitized, digits only). Used for matching against Sverok. | `199001011234`                             |
| `UUID`                        | `Single line text` | A unique identifier for this check-in (generated by n8n).                | `b7d4e1f8-c2a7-...`                         |
| `external_id`                 | `Single line text` | External ID, e.g., from Start.gg registration.                           | `startgg_reg_12345`                        |
| `event_slug`                  | `Single line text` | The Start.gg slug for the event the participant is checking into.        | `fgc-trollhattan-weekly-42`                |
| `startgg_event_id`            | `Single line text` | The ID of the specific Start.gg event (e.g., for a specific game).       | `123456`                                   |
| `tournament_games_registered` | `Multi-select`     | A list of games the participant is registered for in the tournament (from Start.gg). | `["Street Fighter 6", "Tekken 8"]`         |
| `member`                      | `Checkbox`         | `[x]` if the participant is a verified member of the association.        | `[x]`                                      |
| `startgg`                     | `Checkbox`         | `[x]` if the participant is a verified registrant on Start.gg for the event. | `[x]`                                      |
| `payment_amount`              | `Number`           | Amount the participant has paid (from Swish matching or manual entry).   | `100`                                      |
| `payment_expected`            | `Number`           | Expected payment amount.                                                 | `100`                                      |
| `payment_valid`               | `Checkbox`         | `[x]` if the payment has been verified and is correct.                   | `[x]`                                      |
| `status`                      | `Single select`    | Overall status for the participant: `Ready`, `Pending`, `Missing Membership`, `Missing Payment`, `Missing Start.gg`. | `Ready`                                    |
| `created`                     | `Created time`     | Timestamp for when the check-in record was created.                      | `2025-12-17T11:30:00.000Z`                 |

---

## 3. Table: `players` (Potential)

*   **Purpose:** This table can be used as a master list of all players, independent of events. It is currently used sparingly or not at all in the primary flows.
*   **Key Fields:** Could include `name`, `email`, `tag`, `telephone`, `created`.

---

## 4. Table: `event_history` and `event_history_dashboard`

*   **Purpose:** These tables are intended to store archived or denormalized historical data about events for statistics or faster reads for the dashboard. The exact content and how they are populated is not fully defined in the primary flows, but they indicate a need for historical data.
*   **Key Fields:** Likely `event_slug`, `status`, `participants`, `created`.
